
#  Spring boot+docker 半自动化部署(四)、网络设计
网络部署及后期的运维管理是微服务开发管理过程中非常重要的环节。需要提前规划。一个标准的简单的微服务集群需要微服务、网关、数据库（mysql或其它）、redis、服务端的负载均衡。针对微服务的部署，目前主要有几种形式

### 全物理服务器（守旧派）
  微服务、网关、数据库（mysql或其它）、redis、服务端的负载均衡等需要的功能都安装在物理机，这是最早的全物理机的部署方式，现在还有一些守旧的管理人员喜欢这种方式，觉得这种方式最稳定和安全了。有一些管理人员进行了改进，把物理机换成虚拟化的虚拟机。

### 全docker
  微服务、网关、数据库（mysql或其它）、redis、服务端的负载均衡等需要的功能都安装在docker中，这是一种新的虚拟化部署安装方式，使用这种能极大统一安装的环境。采用了这种安装方式，相关的环境只需要装一次，其它即可重用其docker镜像或dockerfile文件，极大地简化部署操作。

### 半docker半物理服务器
 一些经常变化（如开发人员开发的微服务和api网关）服务采用docker,这样无论多少次安装，其环境只需要进行一次的配置即可。其它的如负载均衡、数据库、注册中心、redis则采用物理机安装。因为这些服务只需要安装一次，安装完成之后基本上不用去修改或重装（当然物理机坏了除外），采用全物理机的方式，其性能肯定是优于docker,这种方式最大地利用性能又兼顾了便利性。

 ### 采用容器编排工具
无论是全docker和半docker半物理服务器，其扩容是需要人工手动处理的。为了方便扩容，蓝绿发布等后期的运维工作，对于互联网公司而言，随时都有可能更新版本，这种更新不能中断服务。采用容器是很难完成，这就需要容器编排工具进行自动化编排处理。目前kubernetes一家独大（后期会专门讲解）。采用容器编排的也大约有两种方式，一种是有状态的服务等放在物理机或容器中，其它服务都放在容器编排的网络。 另外一种就是所有服务都放在容器编排网络进行统一管理，这样的管理更方便。

### 服务网格（servermeth)
 这是一种目前还成熟的技术，它是微服务的进一步发展，解决微服务目前所需要的部署工作的烦琐问题。采用一整套解决方案，使得业务服务开发不再需要关注注册中心，网关，监控，日志等众多问题。（后期在kubernete的基础上也会讲到）,就像九十年代开发应用程序，还需要编写网络协议处理一样，后来技术发现，这种微服务公用通用的技术就可以采用服务网格来实现，简化开发。


本次实验采用半docker半物理服务器的方式，也是目前比较主流且保守的方式，其网络图见：
![logo](https://github.com/mgicode/mgicode-k8s-shell/blob/master/doc/01pic/20171122-1423002x.png)
图1 微服务基本环境说明图

图中的数据库、redis及consul都采用物理机集群的方式进行部署。下面的章节分别进行介绍。微服务及与以前部分是容器部署的关键，第三节就可以看出微服务首先需要私有镜像库，私有镜像库如果考虑到高可用，那就复杂一点。它是所有微服务的镜像库，打包的镜像都保存在其中。每台机器需要安装要下载软件，其它机器没有外网，为了提高运行性能，需要文件服务器，把常用的文件都存放在其中。

另外需要安装网络工具，需要yum，也需要先把其rpm下载放到文件服务器上，但是其关联关系难于处理，可以做本地yum源，最佳的方式是安装上网代理，所有都服务器都能通过代理去下载相关的yum。

使用linux部署的人都知道，先要对环境进行初始化，如关防火墙，selinux，大页面等，不然其网络永远都连通不了。
docker作为基础环境，最好每台物理服务器上都安装。

等等，大多需要处理。

### 管理机 
  先初始化自身的环境，对其它机器进行免密处理，通过指令批量初始化所有其它机器。
  安装docker、文件服务器、上网反向代理、docker镜像库，
  有网络权限可以安装nexus3,直接把spring boot的jar上传上去。

其它的机器在第二节已经介绍了。



tv:
322 307 516 
4317
